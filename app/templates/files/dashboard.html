{% extends "layout.html" %}

{% block title %}{{ title }} - 나의 오브젝트 스토리지{% endblock %}

{% block head_content %}
    {# 예시: 페이지 전용 CSS 링크가 필요하다면 아래와 같이 추가할 수 있습니다. #}
    {# <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_specific.css') }}"> #}
{% endblock %}

{% block content %}
<h2>내 파일 대시보드</h2>
<p>이곳에서 파일을 관리하고 업로드할 수 있습니다.</p>

{# 파일 업로드 섹션 #}
<div id="fileUploadSection" style="margin-bottom: 30px; padding: 15px; border: 1px solid #eee; border-radius: 5px; background-color: #f9f9f9;">
    <h3>파일 업로드</h3>
    <form id="uploadForm" enctype="multipart/form-data">
        <div>
            <label for="fileInput">파일 선택:</label>
            <input type="file" id="fileInput" name="file" required>
        </div>
        <button type="submit">업로드</button>
    </form>
    <div id="uploadProgress" style="margin-top:10px; display: none;">
        <div id="uploadProgressBar" style="width: 0%; height: 24px; background-color: #28a745; text-align: center; line-height: 24px; color: white; border-radius: 4px; transition: width 0.3s ease-in-out;">0%</div>
    </div>
    <p id="uploadMessage" style="margin-top: 10px;"></p>
</div>

{# 파일 목록 섹션 #}
<div id="fileListSection">
    <h3>내 파일 목록</h3>
    <table class="file-table">
        <thead>
            <tr>
                <th>파일명</th>
                <th>크기</th>
                <th>업로드 시간</th>
                <th>접근 권한</th>
                <th>작업</th>
            </tr>
        </thead>
        <tbody id="fileListBody">
            {# JavaScript로 파일 목록이 여기에 채워집니다. #}
            <tr>
                <td colspan="5" style="text-align:center;">파일을 불러오는 중...</td>
            </tr>
        </tbody>
    </table>
    <p id="fileListMessage" style="margin-top: 10px;"></p>
</div>

{# 비밀번호 입력 모달 (다운로드용) #}
<div id="passwordModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closePasswordModal">&times;</span>
        <h4>비밀번호 입력</h4>
        <p id="passwordPromptFile" style="margin-bottom: 15px;"></p>
        <input type="password" id="filePasswordInput" placeholder="파일 비밀번호">
        <div class="button-group" style="margin-top: 20px; text-align: right;">
            <button type="button" class="cancel-btn" onclick="document.getElementById('passwordModal').style.display='none'">취소</button>
            <button id="submitPasswordBtn" class="submit-btn">확인</button>
        </div>
        <p id="passwordModalMessage" style="color: red; margin-top: 10px;"></p>
    </div>
</div>

{# 파일 권한 변경 모달 #}
<div id="permissionModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closePermissionModal">&times;</span>
        <h4>파일 권한 변경</h4>
        <p id="permissionFileName" style="margin-bottom: 15px; font-weight:bold;"></p>
        <form id="permissionForm">
            <input type="hidden" id="permissionFileId">
            <div>
                <label for="permissionSelect">새 접근 권한:</label>
                <select id="permissionSelect" name="permission">
                    <option value="private">비공개 (Private)</option>
                    <option value="public">공개 (Public)</option>
                    <option value="password">비밀번호 (Password)</option>
                </select>
            </div>
            <div id="newPasswordSection" style="display: none;">
                <label for="newFilePassword">새 비밀번호 (선택한 권한이 '비밀번호'일 경우):</label>
                <input type="password" id="newFilePassword" name="new_password" placeholder="새 비밀번호 입력">
            </div>
            <div class="button-group" style="margin-top: 20px; text-align: right;">
                 <button type="button" id="cancelPermissionChangeBtn" class="cancel-btn">취소</button>
                 <button type="submit" class="submit-btn">변경 저장</button>
            </div>
        </form>
        <p id="permissionModalMessage" style="color: red; margin-top: 10px;"></p>
    </div>
</div>

{% endblock %}

{% block page_scripts %}
    {# 대시보드 페이지 전용 JavaScript 파일 로드 #}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
